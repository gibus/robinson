From 1a362b2808d91ec9e16c6dc5d45d94a1034333ab Mon Sep 17 00:00:00 2001
From: svaj <svaj@1813622.no-reply.drupal.org>
Date: Wed, 9 Oct 2013 10:14:54 -0700
Subject: [PATCH] Addresses https://drupal.org/node/1985290 handlers producing
 invalid urls for iframes.

---
 video_embed_field.handlers.inc |   11 +++++++++--
 1 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/video_embed_field.handlers.inc b/video_embed_field.handlers.inc
index f0824bd..4e637de 100755
--- a/video_embed_field.handlers.inc
+++ b/video_embed_field.handlers.inc
@@ -140,6 +140,7 @@ function _video_embed_field_get_youtube_id($url) {
  * Handler for Youtube videos.
  */
 function video_embed_field_handle_youtube($url, $settings) {
+  global $is_https;
   $output = array();
 
   //Grab the minutes and seconds, and just convert it down to seconds
@@ -163,7 +164,9 @@ function video_embed_field_handle_youtube($url, $settings) {
   $settings['wmode'] = 'opaque';
   $settings_str = _video_embed_code_get_settings_str($settings);
 
-  $output['#markup'] = '<iframe width="' . $settings['width'] . '" height="' . $settings['height'] . '" src="//www.youtube.com/embed/' . $id . '?' . $settings_str . '" frameborder="0" allowfullscreen></iframe>';
+  $s = ($is_https) ? 's': '';
+
+  $output['#markup'] = '<iframe width="' . $settings['width'] . '" height="' . $settings['height'] . '" src="http:' . $s . '//www.youtube.com/embed/' . $id . '?' . $settings_str . '" frameborder="0" allowfullscreen></iframe>';
 
   return $output;
 }
@@ -371,6 +374,8 @@ function _video_embed_field_get_vimeo_id($url) {
  * Handler for Vimeo videos.
  */
 function video_embed_field_handle_vimeo($url, $settings) {
+  global $is_https;
+
   // Get ID of video from URL
   $id = _video_embed_field_get_vimeo_id($url);
   if (!$id) {
@@ -383,8 +388,10 @@ function video_embed_field_handle_vimeo($url, $settings) {
   $settings['portrait'] = 0;
   $settings_str = _video_embed_code_get_settings_str($settings);
 
+  $s = ($is_https) ? 's': '';
+
   return array(
-    '#markup' => '<iframe width="' . $settings['width'] . '" height="' . $settings['height'] . '" src="//player.vimeo.com/video/' . $id .
+    '#markup' => '<iframe width="' . $settings['width'] . '" height="' . $settings['height'] . '" src="http' . $s . '://player.vimeo.com/video/' . $id .
                  '?' . $settings_str . '" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>',
   );
 }
-- 
1.7.7.5 (Apple Git-26)

